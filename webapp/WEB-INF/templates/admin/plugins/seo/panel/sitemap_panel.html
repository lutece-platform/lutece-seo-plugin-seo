

<div class="row-fluid">  
    <div class="well span6">
        <h3>#i18n{seo.panel.sitemap.titleManageSitemap}</h3>
        <p>#i18n{seo.panel.sitemap.explainManageSitemap}</p>    
        <p>
            <a href="http://www.sitemaps.org/fr/" title="lien vers le site officiel">
                #i18n{seo.panel.sitemap.labelMore}<img src="images/admin/skin/external-link.png" alt="External Link" title=" " />
            </a>
        </p>
        <div id="modal" class="modal hide fade in" style="display: none; ">
            <div class="modal-header">
                <a class="close" data-dismiss="modal">Ã—</a>
                <h3>Sitemap</h3>
            </div>
            <div class="modal-body">
                <pre id="sitemap" class="pre-scrollable prettyprint linenums" >
                </pre>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn" data-dismiss="modal">Close</a>
            </div>
        </div>


        <p>
            <a data-toggle="modal" href="#modal" class="btn btn-primary pull-right">
                <i class="icon-eye-open icon-white"></i>
                #i18n{seo.panel.sitemap.buttonDisplaySitemap}
            </a>
        </p>

    </div>
    <div class="well span6">
        <h3>#i18n{seo.panel.sitemap.titleGenerate}</h3>
        <div class="alert alert-info">
            ${sitemapLastGeneration}
        </div>
        <div>
            <form action="jsp/admin/plugins/seo/DoGenerateSitemap.jsp" method="GET">
                <button class="btn btn-primary pull-right" type="submit">
                    <i class="icon-refresh icon-white" ></i>
                    #i18n{seo.panel.sitemap.buttonUpdateFile}
                </button>
            </form>
            <br><br><br>
        </div>
        <div>
            #i18n{seo.panel.sitemap.explainGenerate}
            <br>
        </div>
        <#if daemon_enabled >
        #i18n{seo.panel.sitemap.labelStatus} : <span class="label label-success"><i class="icon-ok-sign icon-white"></i> #i18n{portal.util.labelEnabled}</span>
        <br>
        <form method="post"  action="jsp/admin/plugins/seo/DoSitemapDaemonToggle.jsp">
            <button class="btn btn-danger pull-right" type="submit" >
                <i class="icon-stop icon-white"></i>
                #i18n{seo.panel.sitemap.buttonDisableGenerate}
            </button>
        </form>


        <#else>
        #i18n{seo.panel.sitemap.labelStatus} : <span class="label label-important"><i class="icon-remove-sign icon-white"></i> #i18n{portal.util.labelDisabled}</span>.
        <br>
        <form method="post"  action="jsp/admin/plugins/seo/DoSitemapDaemonToggle.jsp">
            <button class="btn btn-success btn-small pull-right" type="submit" >
                <i class="icon-play icon-white"></i>
                #i18n{seo.panel.sitemap.buttonEnableGenerate}
            </button>
        </form>
        </#if>

    </div>
</div>


<script>
    function format( source , tag )
    {
        var s1 = '/&lt;' + tag + '&gt;/g';
        var d1 = '<b>&lt;' + tag + '&gt;</b>'
        var s2 = '/&lt;\/' + tag + '&gt;/g';
        var d2 = '<b>&lt;\/' + tag + '&gt;</b>\n'
        return source.replace( s1, d1).replace( s2, d2 );
    }
    
    $('#sitemap').load('sitemap.xml', function() {
    var content = $('#sitemap').html();
    content = content.replace(/&/g, "&amp;").replace(/>/g, "&gt;").replace(/</g, "&lt;").replace(/"/g, "&quot;");
    content = content.replace(/&lt;url&gt;/g, "<br><b>&lt;url&gt;</b><br>").replace(/&lt;\/url&gt;/g, "<b>&lt;\/url&gt;</b><br>");
    content = content.replace(/&lt;loc&gt;/g, "<b>&lt;loc&gt;</b>").replace(/&lt;\/loc&gt;/g, "<b>&lt;\/loc&gt;</b><br>");
    content = content.replace(/&lt;priority&gt;/g, "<b>&lt;priority&gt;</b>").replace(/&lt;\/priority&gt;/g, "<b>&lt;\/priority&gt;</b><br>");
    content = content.replace(/&lt;lastmod&gt;/g, "<b>&lt;lastmod&gt;</b>").replace(/&lt;\/lastmod&gt;/g, "<b>&lt;\/lastmod&gt;</b><br>");
    content = content.replace(/&lt;changefreq&gt;/g, "<b>&lt;changefreq&gt;</b>").replace(/&lt;\/changefreq&gt;/g, "<b>&lt;\/changefreq&gt;</b><br>");
    content = format( content , 'lastmod' );
    $('#sitemap').replaceWith( content );
    });
  
    
</script>
