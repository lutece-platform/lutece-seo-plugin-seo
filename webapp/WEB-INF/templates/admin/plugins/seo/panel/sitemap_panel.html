<@row>
    <@columns>
        <@box>
            <@boxHeader title='#i18n{seo.panel.sitemap.titleManageSitemap}' />
			<@boxBody>
				<p>#i18n{seo.panel.sitemap.explainManageSitemap}</p>
				<p>
                    <@btnGroup align='right'>
                        <@aButton href='http://www.sitemaps.org/fr/' title='#i18n{seo.panel.sitemap.labelMore}' buttonIcon='external-link' iconPosition='right' />
                        <@button type='button' buttonIcon='file-o' title='#i18n{seo.panel.sitemap.buttonDisplaySitemap}' params=' data-toggle="modal" data-target="#sitemapModal"' />
                    </@btnGroup>
				</p>
                    
			</@boxBody>
		</@box>
	</@columns>
</@row>
<@row>
    <@columns>
        <@box>
            <@boxHeader title='#i18n{seo.panel.sitemap.titleGenerate}'>
				<form class="form-inline pull-right spaced" action="jsp/admin/plugins/seo/DoGenerateSitemap.jsp" method="GET">
					<@button type='submit' color='primary' buttonIcon='refresh' title='#i18n{seo.panel.sitemap.buttonUpdateFile}' />
				</form>
			</@boxHeader>
			<@boxBody>
			<#if sitemapLastGeneration?has_content>
				<@alert color='info'>
					<span class="fa fa-info"></span> ${sitemapLastGeneration}
				</@alert>
				</#if>
				<p class="text-info">
				<#if daemon_enabled >
					#i18n{seo.panel.sitemap.explainGenerate} <@tag color='success' tagIcon='check-circle'> #i18n{seo.panel.sitemap.labelStatus}  #i18n{portal.util.labelEnabled}</@tag>
				<#else>
					#i18n{seo.panel.sitemap.explainGenerate} <@tag color='danger' tagIcon='times-circle' > #i18n{seo.panel.sitemap.labelStatus}  #i18n{portal.util.labelDisabled}</@tag>.
				</#if>
				</p>
				<form method="post" class="form-inline" action="jsp/admin/plugins/seo/DoSitemapDaemonToggle.jsp">
                    <@btnGroup align='right'>
                    <#if daemon_enabled >
                        <@button type='submit' color='danger' buttonIcon='stop' title='#i18n{seo.panel.sitemap.buttonDisableGenerate}' />
                    <#else>
                        <@button type='submit' color='success' buttonIcon='play' title='#i18n{seo.panel.sitemap.buttonEnableGenerate}' />
                    </#if>
                     </@btnGroup>
				</form>
            </@boxBody>
		</@box>
	</@columns>
</@row>

<!-- Modal -->
<div class="modal fade" id="sitemapModal" tabindex="-1" role="dialog" aria-labelledby="sitemapModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="sitemapModalLabel">Sitemap</h4>
      </div>
      <div class="modal-body">
        <pre>
			<code id="sitemap" class="language-html" data-lang="html"></code>
		</pre>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">#i18n{portal.util.labelCancel}</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<script>
function format( source , tag ) {
	var s1 = '/&lt;' + tag + '&gt;/g';
    var d1 = '<b>&lt;' + tag + '&gt;</b>'
    var s2 = '/&lt;\/' + tag + '&gt;/g';
    var d2 = '<b>&lt;\/' + tag + '&gt;</b>\n'
    return source.replace( s1, d1).replace( s2, d2 );
}

$(document).ready( function(){
    $('#sitemap').load('sitemap.xml', function() {
		var content = $('#sitemap').html();
		content = content.replace(/&/g, "&amp;").replace(/>/g, "&gt;").replace(/</g, "&lt;").replace(/"/g, "&quot;");
		content = content.replace(/&lt;url&gt;/g, "<br><b>&lt;url&gt;</b><br>").replace(/&lt;\/url&gt;/g, "<b>&lt;\/url&gt;</b><br>");
		content = content.replace(/&lt;loc&gt;/g, "<b>&lt;loc&gt;</b>").replace(/&lt;\/loc&gt;/g, "<b>&lt;\/loc&gt;</b><br>");
		content = content.replace(/&lt;priority&gt;/g, "<b>&lt;priority&gt;</b>").replace(/&lt;\/priority&gt;/g, "<b>&lt;\/priority&gt;</b><br>");
		content = content.replace(/&lt;lastmod&gt;/g, "<b>&lt;lastmod&gt;</b>").replace(/&lt;\/lastmod&gt;/g, "<b>&lt;\/lastmod&gt;</b><br>");
		content = content.replace(/&lt;changefreq&gt;/g, "<b>&lt;changefreq&gt;</b>").replace(/&lt;\/changefreq&gt;/g, "<b>&lt;\/changefreq&gt;</b><br>");
		content = format( content , 'lastmod' );
		$('#sitemap').html( content );
    });
});
</script>
